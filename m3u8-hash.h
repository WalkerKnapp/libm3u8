#pragma once

#include "m3u8-types.h"

#define _HSH (unsigned long)

#define EXT _HSH 193455126

#define EXTM3U _HSH 2939863755
#define EXT_X_VERSION _HSH 853555278
#define EXTINF _HSH 2939860275
#define EXT_X_BYTERANGE _HSH 1092799145
#define EXT_X_DISCONTINUITY _HSH 3434959166
#define EXT_X_KEY _HSH 1068409489
#define EXT_X_MAP _HSH 1068411526
#define EXT_X_PROGRAM_DATE_TIME _HSH 3544035463
#define EXT_X_DATERANGE _HSH 66041747
#define EXT_X_TARGETDURATION _HSH 4093728053
#define EXT_X_MEDIA_SEQUENCE _HSH 676004846
#define EXT_X_DISCONTINUITY_SEQUENCE _HSH 1503461828
#define EXT_X_ENDLIST _HSH 708800507
#define EXT_X_PLAYLIST_TYPE _HSH 3758762729
#define EXT_X_I_FRAMES_ONLY _HSH 3173334059
#define EXT_X_MEDIA _HSH 3859115048
#define EXT_X_STREAM_INF _HSH 1683835134
#define EXT_X_I_FRAME_STREAM_INF _HSH 2383712044
#define EXT_X_SESSION_DATA _HSH 3392850451
#define EXT_X_SESSION_KEY _HSH 2185229794
#define EXT_X_INDEPENDENT_SEGMENTS _HSH 1958029033
#define EXT_X_START _HSH 3866766678

#define KEY_ATTRIBUTE_METHOD _HSH 3230409862
#define KEY_ATTRIBUTE_METHOD_NONE _HSH 2089365365
#define KEY_ATTRIBUTE_METHOD_AES_128 _HSH 909407174
#define KEY_ATTRIBUTE_METHOD_SAMPLE_AES _HSH 3975550861
#define KEY_ATTRIBUTE_URI _HSH 193472341
#define KEY_ATTRIBUTE_IV _HSH 5862404
#define KEY_ATTRIBUTE_KEYFORMAT _HSH 744233175
#define KEY_ATTRIBUTE_KEYFORMATVERSIONS _HSH 710228720
#define MAP_ATTRIBUTE_URI _HSH 193472341
#define MAP_ATTRIBUTE_BYTERANGE _HSH 102065414
#define PLAYLIST_TYPE_ATTRIBUTE_EVENT _HSH 219149159
#define PLAYLIST_TYPE_ATTRIBUTE_VOD _HSH 193473326
#define MEDIA_ATTRIBUTE_TYPE _HSH 2089591943
#define MEDIA_ATTRIBUTE_TYPE_AUDIO _HSH 214368279
#define MEDIA_ATTRIBUTE_TYPE_VIDEO _HSH 238841244
#define MEDIA_ATTRIBUTE_TYPE_SUBTITLES _HSH 3390977124
#define MEDIA_ATTRIBUTE_TYPE_CLOSED_CAPTIONS _HSH 3913860109
#define MEDIA_ATTRIBUTE_URI _HSH 193472341
#define MEDIA_ATTRIBUTE_GROUP_ID _HSH 1754471980
#define MEDIA_ATTRIBUTE_LANGUAGE _HSH 3857633481
#define MEDIA_ATTRIBUTE_ASSOC_LANGUAGE _HSH 3437708687
#define MEDIA_ATTRIBUTE_NAME _HSH 2089350086
#define MEDIA_ATTRIBUTE_DEFAULT _HSH 474185642
#define MEDIA_ATTRIBUTE_AUTOSELECT _HSH 4146624926
#define MEDIA_ATTRIBUTE_YES _HSH 193476278
#define MEDIA_ATTRIBUTE_NO _HSH 5862562
#define MEDIA_ATTRIBUTE_FORCED _HSH 2968243672
#define MEDIA_ATTRIBUTE_INSTREAM_ID _HSH 3319976162
#define MEDIA_ATTRIBUTE_CHARACTERISTICS _HSH 4267390721
#define MEDIA_ATTRIBUTE_CHANNELS _HSH 2493371537
#define STREAMINF_ATTRIBUTE_BANDWIDTH _HSH 269848442
#define STREAMINF_ATTRIBUTE_AVERAGE_BANDWIDTH _HSH 1470969826
#define STREAMINF_ATTRIBUTE_CODECS _HSH 2850336502
#define STREAMINF_ATTRIBUTE_RESOLUTION _HSH 4171569433
#define STREAMINF_ATTRIBUTE_FRAME_RATE _HSH 1756982409
#define STREAMINF_ATTRIBUTE_HDCP_LEVEL _HSH 2611027913
#define STREAMINF_ATTRIBUTE_HDCP_LEVEL_NONE _HSH 2089365365
#define STREAMINF_ATTRIBUTE_HDCP_LEVEL_TYPE_0 _HSH 3527927876
#define STREAMINF_ATTRIBUTE_AUDIO _HSH 214368279
#define STREAMINF_ATTRIBUTE_VIDEO _HSH 238841244
#define STREAMINF_ATTRIBUTE_SUBTITLES _HSH 3390977124
#define STREAMINF_ATTRIBUTE_CLOSED_CAPTIONS _HSH 3913860109
#define ISTREAMINF_ATTRIBUTE_URI _HSH 193472341
#define SESSION_DATA_ATTRIBUTE_DATA_ID _HSH 334203289
#define SESSION_DATA_ATTRIBUTE_VALUE _HSH 238562978
#define SESSION_DATA_ATTRIBUTE_URI _HSH 193472341
#define SESSION_DATA_ATTRIBUTE_LANGUAGE _HSH 3857633481
#define START_ATTRIBUTE_TIME_OFFSET _HSH 3512973640
#define START_ATTRIBUTE_PRECISE 3594532592
#define START_ATTRIBUTE_PRECISE_YES _HSH 193476278
#define START_ATTRIBUTE_PRECISE_NO _HSH 5862562


#define HASH_START_VALUE _HSH 5381
#define hash_char(hash, ch) hash = ((hash << 5) + hash) + ch;

const unsigned long hash(const char *str) {
    unsigned long hash = 5381;
    int c;

    while ((c = *str++))
        hash = ((hash << 5) + hash) + c;
    return hash;
}

enum playlist_type get_m3u8_tag_type(unsigned long hash) {
    switch(hash) {
        case EXTM3U:
        case EXT_X_VERSION:
            return UNKNOWN;
        case EXTINF:
        case EXT_X_BYTERANGE:
        case EXT_X_DISCONTINUITY:
        case EXT_X_KEY:
        case EXT_X_MAP:
        case EXT_X_PROGRAM_DATE_TIME:
        case EXT_X_DATERANGE:
            return MEDIA_PLAYLIST;
        case EXT_X_TARGETDURATION:
        case EXT_X_MEDIA_SEQUENCE:
        case EXT_X_DISCONTINUITY_SEQUENCE:
        case EXT_X_ENDLIST:
        case EXT_X_PLAYLIST_TYPE:
        case EXT_X_I_FRAMES_ONLY:
            return MEDIA_PLAYLIST;
        case EXT_X_MEDIA:
        case EXT_X_STREAM_INF:
        case EXT_X_I_FRAME_STREAM_INF:
        case EXT_X_SESSION_DATA:
        case EXT_X_SESSION_KEY:
            return MASTER_PLAYLIST;
        case EXT_X_INDEPENDENT_SEGMENTS:
        case EXT_X_START:
            return UNKNOWN;
        default:
            return UNKNOWN;
    }
}

bool m3u8_is_tag_custom(unsigned long hash) {
    switch(hash) {
        case EXTM3U:
        case EXT_X_VERSION:
        case EXTINF:
        case EXT_X_BYTERANGE:
        case EXT_X_DISCONTINUITY:
        case EXT_X_KEY:
        case EXT_X_MAP:
        case EXT_X_PROGRAM_DATE_TIME:
        case EXT_X_DATERANGE:
        case EXT_X_TARGETDURATION:
        case EXT_X_MEDIA_SEQUENCE:
        case EXT_X_DISCONTINUITY_SEQUENCE:
        case EXT_X_ENDLIST:
        case EXT_X_PLAYLIST_TYPE:
        case EXT_X_I_FRAMES_ONLY:
        case EXT_X_MEDIA:
        case EXT_X_STREAM_INF:
        case EXT_X_I_FRAME_STREAM_INF:
        case EXT_X_SESSION_DATA:
        case EXT_X_SESSION_KEY:
        case EXT_X_INDEPENDENT_SEGMENTS:
        case EXT_X_START:
            return false;
        default:
            return true;
    }
}